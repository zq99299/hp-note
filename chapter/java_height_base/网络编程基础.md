# 网络编程基础
## 2. 解释下访问一个外网域名网页的过程中，都先后发生了哪些网络通讯过程

    > https://github.com/skyline75489/what-happens-when-zh_CN/blob/master/README.rst
    
    1. DNS 查询
    
    2.  ARP（地址解析协议）
    
    ```
    ARP Request:
    Sender MAC: interface:mac:address:here
    Sender IP: interface.ip.goes.here
    Target MAC: FF:FF:FF:FF:FF:FF (Broadcast、广播)
    Target IP: target.ip.goes.here
    
    ARP Reply: (arp响应)
    Sender MAC: target:mac:address:here
    Sender IP: target.ip.goes.here
    Target MAC: interface:mac:address:here
    Target IP: interface.ip.goes.here
    ```
        

## 3. DNS解析与主机的Host文件有什么关系
    
    首先DNS和Host的作用都是把域名转换成ip地址；
    host文件是早期的时代的产物，随着时代的发展，域名越来越多，host文件就不再适用了，于是出现了DNS（Domain Name System，域名系统）
    host文件解析的方式还是被保留，优先于dns；先从host中查找，找不到再去请求dns服务；
    
## 4. Ping是TCP还是UDP，或者是其他？其报文和过程是怎样的
![](/assets/java_height_base/v2-a117e931556148df4fecc8f94b186493_hd.jpg)
ICMP和TCP以及UDP都是IP协议的上层协议。
ICMP直接用的是IP协议，自然不需要TCP和UDP

## 5. 了解TCP三次握手过程

TCP在传输之前会进行三次沟通，一般称为“三次握手”，传完数据断开的时候要进行四次沟通，一般称为“四次挥手”。

两个序号和三个标志位：
* （1）序号：seq序号，占32位，用来标识从TCP源端向目的端发送的字节流，发起方发送数据时对此进行标记。
* （2）确认序号：ack序号，占32位，只有ACK标志位为1时，确认序号字段才有效，ack=seq+1。
* （3）标志位：共6个，即URG、ACK、PSH、RST、SYN、FIN等，具体含义如下：
  
  * （A）URG：紧急指针（urgent pointer）有效。
  * （B）ACK：确认序号有效。
  * （C）PSH：接收方应该尽快将这个报文交给应用层。
  * （D）RST：重置连接。
  * （E）SYN：发起一个新连接。
  * （F）FIN：释放一个连接。
  
需要注意的是：
* 不要将确认序号ack与标志位中的ACK搞混了。
* 确认方ack=发起方req+1，两端配对。

![](/assets/java_height_base/tcp三次握手过程.png)

为什么会有第三次握手？
为了解决非正常情况下的问题：如：

* A发起sq=1的请求，由于网络延迟，没有送达B
* 此时A在规定时间内未得到回应，就再发起了一次请求sq=2
* 此时sq=1的请求到达B,如果B同意了，则建立链接等待A发送数据，并响应确认；
* A收到ack=1+1的响应；由于此时己方sq=2；所以不匹配，不理睬；就造成了一个失效的链接；

### 四次挥手断开

![](/assets/java_height_base/tcp四次挥手.png)
由于TCP连接时全双工的，因此，每个方向都必须要单独进行关闭，这一原则是当一方完成数据发送任务后，发送一个FIN来终止这一方向的连接，

```
1. Client -> fin m      自己Fin_Wait_1：关闭client到server的数据传送
2. Server -> ack m+1    自己close_wait：
3. Server -> fin n      自己last_ack状态：关闭Server到Client的数据传送
4. Client -> ACK=1,ack=N+1   Server进入Closed状态  
```






